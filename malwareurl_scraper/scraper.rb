#!/usr/bin/ruby
require 'rubygems'
require 'hpricot'
require 'open-uri'
require 'active_support'

xml = Builder::XmlMarkup.new(:indent=>3)
xml.instruct!
xml.urls do
  (1..2).each do |i|
    doc = Hpricot(open("http://www.malwareurl.com/listing-urls.php?page=#{i}&urls=off&rp="))
    doc.search("//table[@id='tablesorterID']/tbody/tr").each do |row|
      xml.url do
        xml.domain row.search("/td[1]").inner_html
        xml.ip row.search("/td[2]/div").inner_html
        xml.details("http://www.malwareurl.com/"+row.search("td[9]/div/a").first.attributes['href'])
      end
    end
  end
end  

print xml.target!
